<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTT ËΩ¨ LRC ËΩ¨Êç¢Âô®</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 40px auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.2rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .upload-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px dashed #3498db;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #2980b9;
            background-color: #f0f8ff;
        }
        
        .upload-section.disabled {
            border-color: #cccccc;
            background-color: #f5f5f5;
            opacity: 0.7;
        }
        
        .upload-section.dragover {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .upload-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #3498db;
            font-size: 1.2rem;
        }
        
        .file-input-container {
            margin-bottom: 15px;
        }
        
        .file-input-label {
            display: block;
            padding: 15px 20px;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .file-input-label:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .file-input-label.disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #file-input {
            display: none;
        }
        
        .drag-drop-area {
            margin-top: 15px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 8px;
            text-align: center;
            border: 1px dashed #3498db;
            transition: all 0.3s;
        }
        
        .drag-drop-area:hover {
            background-color: #e6f3ff;
        }
        
        .file-list {
            margin-top: 15px;
            padding: 12px;
            background-color: #fff;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }
        
        .file-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-name {
            font-weight: 500;
        }
        
        .file-size {
            color: #666;
            font-size: 0.9rem;
        }
        
        .file-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        .convert-section {
            margin-bottom: 25px;
        }
        
        .convert-button {
            padding: 15px 20px;
            background: linear-gradient(to right, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .convert-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .convert-button:disabled {
            background: linear-gradient(to right, #cccccc, #aaaaaa);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            margin-top: 15px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .results-section {
            margin-top: 25px;
            display: none;
        }
        
        .results-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
        }
        
        .result-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .result-info {
            flex-grow: 1;
        }
        
        .result-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .result-status {
            color: #4CAF50;
            font-size: 0.9rem;
        }
        
        .download-button {
            padding: 8px 16px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .download-button:hover {
            background-color: #0b7dda;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .status-message {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .status-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.1);
            color: #c62828;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .status-info {
            background-color: rgba(33, 150, 243, 0.1);
            color: #1565c0;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        .status-warning {
            background-color: rgba(255, 152, 0, 0.1);
            color: #ef6c00;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }
        
        .browser-support {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .icon {
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 20px auto;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .download-button {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ VTT ËΩ¨ LRC ËΩ¨Êç¢Âô®</h1>
        
        <div id="browser-support" class="browser-support" style="display: none;">
            <span class="icon">‚ö†Ô∏è</span> ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÊñá‰ª∂‰∏ä‰º†ÂäüËÉΩÔºåËØ∑‰ΩøÁî®Áé∞‰ª£ÊµèËßàÂô®Â¶ÇChrome„ÄÅFirefoxÊàñEdge„ÄÇ
        </div>
        
        <div id="upload-section" class="upload-section">
            <div class="upload-title">üìÅ ÈÄâÊã© VTT Êñá‰ª∂</div>
            
            <div class="file-input-container">
                <label for="file-input" class="file-input-label">
                    <span class="icon">üìÇ</span> ÁÇπÂáªÈÄâÊã© VTT Êñá‰ª∂ÔºàÂèØÂ§öÈÄâÔºâ
                </label>
                <input type="file" id="file-input" accept=".vtt" multiple>
            </div>
            
            <div class="drag-drop-area" id="drag-drop-area">
                <span class="icon">üìÅ</span> ÊàñËÄÖÊãñÊîæ VTT Êñá‰ª∂Âà∞ËøôÈáå
            </div>
            
            <div class="file-info">ÊîØÊåÅÊ†ºÂºèÔºö.vttÔºåÂçï‰∏™Êñá‰ª∂ÊúÄÂ§ß10MB</div>
            <div id="file-list" class="file-list">Êú™ÈÄâÊã©Êñá‰ª∂</div>
        </div>
        
        <div class="convert-section">
            <button id="convert-button" class="convert-button">
                <span class="icon">üîÑ</span> ÂºÄÂßãËΩ¨Êç¢
            </button>
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
        </div>
        
        <div id="status-message" class="status-message" style="display: none;"></div>
        
        <div id="results-section" class="results-section">
            <div class="results-title">‚úÖ ËΩ¨Êç¢ÁªìÊûú</div>
            <div id="results-container"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÊîØÊåÅFile API
            if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                document.getElementById('browser-support').style.display = 'block';
                document.getElementById('upload-section').classList.add('disabled');
                document.querySelector('.file-input-label').classList.add('disabled');
                document.getElementById('convert-button').disabled = true;
                return;
            }
            
            const fileInput = document.getElementById('file-input');
            const fileList = document.getElementById('file-list');
            const convertButton = document.getElementById('convert-button');
            const statusMessage = document.getElementById('status-message');
            const resultsSection = document.getElementById('results-section');
            const resultsContainer = document.getElementById('results-container');
            const progressBar = document.getElementById('progress-bar');
            const dragDropArea = document.getElementById('drag-drop-area');
            const uploadSection = document.getElementById('upload-section');
            
            let selectedFiles = [];
            let convertedFiles = [];
            const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
            
            // Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂
            fileInput.addEventListener('change', handleFileSelect);
            
            // ÊãñÊîæ‰∫ã‰ª∂
            dragDropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadSection.classList.add('dragover');
            });
            
            dragDropArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadSection.classList.remove('dragover');
            });
            
            dragDropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadSection.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
            
            // Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }
            
            // Â§ÑÁêÜÊñá‰ª∂
            function handleFiles(files) {
                const filesArray = Array.from(files);
                selectedFiles = [];
                let hasErrors = false;
                
                // È™åËØÅÊñá‰ª∂
                filesArray.forEach(file => {
                    // Ê£ÄÊü•Êñá‰ª∂Á±ªÂûã
                    if (!file.name.toLowerCase().endsWith('.vtt')) {
                        showStatus(`Êñá‰ª∂ "${file.name}" ‰∏çÊòØÊúâÊïàÁöÑVTTÊñá‰ª∂`, 'error');
                        hasErrors = true;
                        return;
                    }
                    
                    // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è
                    if (file.size > MAX_FILE_SIZE) {
                        showStatus(`Êñá‰ª∂ "${file.name}" Ë∂ÖËøá10MBÂ§ßÂ∞èÈôêÂà∂`, 'error');
                        hasErrors = true;
                        return;
                    }
                    
                    selectedFiles.push(file);
                });
                
                updateFileList();
                resetConversion();
                
                if (hasErrors) {
                    showStatus('ÈÉ®ÂàÜÊñá‰ª∂‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÔºåËØ∑Ê£ÄÊü•', 'warning');
                } else if (selectedFiles.length > 0) {
                    showStatus(`Â∑≤ÈÄâÊã© ${selectedFiles.length} ‰∏™Êñá‰ª∂`, 'info');
                }
            }
            
            // Êõ¥Êñ∞Êñá‰ª∂ÂàóË°®ÊòæÁ§∫
            function updateFileList() {
                if (selectedFiles.length === 0) {
                    fileList.innerHTML = '<div style="text-align: center; color: #666;">Êú™ÈÄâÊã©Êñá‰ª∂</div>';
                    return;
                }
                
                fileList.innerHTML = '';
                selectedFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const fileName = document.createElement('div');
                    fileName.className = 'file-name';
                    fileName.textContent = file.name;
                    
                    const fileSize = document.createElement('div');
                    fileSize.className = 'file-size';
                    fileSize.textContent = formatFileSize(file.size);
                    
                    fileItem.appendChild(fileName);
                    fileItem.appendChild(fileSize);
                    fileList.appendChild(fileItem);
                });
            }
            
            // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message status-' + type;
                statusMessage.style.display = 'block';
                
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 5000);
                }
            }
            
            // ÈáçÁΩÆËΩ¨Êç¢Áä∂ÊÄÅ
            function resetConversion() {
                convertButton.disabled = false;
                progressBar.style.width = '0%';
                resultsSection.style.display = 'none';
                resultsContainer.innerHTML = '';
                convertedFiles = [];
            }
            
            // ËΩ¨Êç¢ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            convertButton.addEventListener('click', function() {
                if (selectedFiles.length === 0) {
                    showStatus('ËØ∑ÂÖàÈÄâÊã©VTTÊñá‰ª∂', 'error');
                    return;
                }
                
                // Á¶ÅÁî®ÊåâÈíÆ
                convertButton.disabled = true;
                
                // ÈáçÁΩÆÁä∂ÊÄÅ
                resetConversion();
                showStatus('Ê≠£Âú®ËΩ¨Êç¢Êñá‰ª∂...', 'info');
                
                // Â§ÑÁêÜÊñá‰ª∂ËΩ¨Êç¢
                processFiles();
            });
            
            // Â§ÑÁêÜÊñá‰ª∂ËΩ¨Êç¢
            async function processFiles() {
                const totalFiles = selectedFiles.length;
                let processedCount = 0;
                let successCount = 0;
                
                for (const file of selectedFiles) {
                    try {
                        // ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ
                        const content = await readFileContent(file);
                        
                        // ËΩ¨Êç¢VTTÂà∞LRC
                        const lrcContent = convertVttToLrc(content, file.name);
                        
                        // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                        const lrcFileName = getFileNameWithoutExtension(file.name) + '.lrc';
                        const blob = new Blob([lrcContent], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        
                        convertedFiles.push({
                            name: lrcFileName,
                            url: url,
                            originalName: file.name,
                            size: blob.size
                        });
                        
                        successCount++;
                    } catch (error) {
                        console.error(`Â§ÑÁêÜ ${file.name} Êó∂Âá∫Èîô:`, error);
                        showStatus(`Â§ÑÁêÜÊñá‰ª∂ "${file.name}" Êó∂Âá∫Èîô: ${error.message}`, 'error');
                    }
                    
                    processedCount++;
                    updateProgress((processedCount / totalFiles) * 100);
                }
                
                // ËΩ¨Êç¢ÂÆåÊàê
                if (successCount === totalFiles) {
                    showStatus(`ÊàêÂäüËΩ¨Êç¢‰∫Ü ${successCount} ‰∏™Êñá‰ª∂ÔºÅ`, 'success');
                } else {
                    showStatus(`ËΩ¨Êç¢ÂÆåÊàêÔºÅÊàêÂäü: ${successCount} ‰∏™ÔºåÂ§±Ë¥•: ${totalFiles - successCount} ‰∏™`, 'info');
                }
                
                // ÊòæÁ§∫ÁªìÊûú
                showResults();
                
                // ÈáçÊñ∞ÂêØÁî®ÊåâÈíÆ
                convertButton.disabled = false;
            }
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            function updateProgress(percent) {
                progressBar.style.width = `${percent}%`;
            }
            
            // ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ
            function readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = event => resolve(event.target.result);
                    reader.onerror = error => reject(error);
                    reader.readAsText(file, 'UTF-8');
                });
            }
            
            // Ëé∑Âèñ‰∏çÂ∏¶Êâ©Â±ïÂêçÁöÑÊñá‰ª∂Âêç
            function getFileNameWithoutExtension(filename) {
                const knownExtensions = [
                    'mp3', 'wav', 'acc', 'flac', 
                    'vtt', 'srt', 'lrc'
                ];
                
                const parts = filename.split('.');
                if (parts.length === 1) return filename;
                
                const extension = parts[parts.length - 1].toLowerCase();
                if (knownExtensions.includes(extension)) {
                    return parts.slice(0, -1).join('.');
                }
                
                return filename;
            }
            
            // ËΩ¨Êç¢VTTÂà∞LRC
            function convertVttToLrc(vttContent, fileName) {
                const lines = vttContent.split('\n');
                const lrcLines = [];
                let startTime = "";
                let endTime = "";
                let count = 1;
                let subtitleMarkerExists = false;
                let subtitleAdd = "";
                
                // Ê≠£ÂàôË°®ËææÂºèÂåπÈÖçÊó∂Èó¥Êà≥
                const timeRegex = /(\d{2}):(\d{2}):(\d{2})\.(\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2})\.(\d{3})/;
                
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    
                    // ÂåπÈÖçÊó∂Èó¥Êà≥Ë°å
                    const timeMatch = trimmedLine.match(timeRegex);
                    if (timeMatch) {
                        if (count !== 1) {
                            lrcLines.push(`${startTime}${subtitleAdd}\n${endTime}\n`);
                            subtitleAdd = "";
                        }
                        
                        // ËΩ¨Êç¢ÂºÄÂßãÊó∂Èó¥
                        const startHours = parseInt(timeMatch[1]);
                        const startMinutes = parseInt(timeMatch[2]);
                        const startSeconds = parseInt(timeMatch[3]);
                        const startMs = parseInt(timeMatch[4]);
                        
                        const startTotalMinutes = (startHours * 60 + startMinutes).toString().padStart(2, '0');
                        const startSec = startSeconds.toString().padStart(2, '0');
                        const startMs2 = Math.round(startMs / 10).toString().padStart(2, '0');
                        startTime = `[${startTotalMinutes}:${startSec}.${startMs2}]`;

                        // ËΩ¨Êç¢ÁªìÊùüÊó∂Èó¥
                        const endTotalMinutes = (endHours * 60 + endMinutes).toString().padStart(2, '0');
                        const endSec = endSeconds.toString().padStart(2, '0');
                        const endMs2 = Math.round(endMs / 10).toString().padStart(2, '0');
                        endTime = `[${endTotalMinutes}:${endSec}.${endMs2}]`;
                        
                        count++;
                    }
                    // Ê£ÄÊü•ÊòØÂê¶‰∏∫Á∫ØÈòøÊãâ‰ºØÊï∞Â≠ó
                    else if (/^\d+$/.test(trimmedLine)) {
                        if (count === parseInt(trimmedLine) && !subtitleMarkerExists) {
                            subtitleMarkerExists = true;
                            continue;
                        } else {
                            subtitleAdd += trimmedLine + " ";
                            subtitleMarkerExists = false;
                        }
                    }
                    // Ë∑≥ËøáÁ©∫Ë°å
                    else if (!trimmedLine) {
                        continue;
                    }
                    // Â§ÑÁêÜÂ≠óÂπïÊñáÊú¨
                    else {
                        if (startTime && endTime) {
                            subtitleAdd += trimmedLine + " ";
                            subtitleMarkerExists = false;
                        }
                    }
                }
                
                // Ê∑ªÂä†ÊúÄÂêé‰∏ÄË°åÂ≠óÂπï
                lrcLines.push(`${startTime}${subtitleAdd}\n${endTime}\n`);
                
                // ÁîüÊàêLRCÊñá‰ª∂ÂÜÖÂÆπ
                const lrcFileName = getFileNameWithoutExtension(fileName) + '.lrc';
                let lrcContent = `[ti:${lrcFileName}]\n`;
                lrcContent += "[by: ÁΩëÈ°µÁâàËΩ¨Êç¢Âô®]\n";
                
                for (const line of lrcLines) {
                    lrcContent += line;
                }
                
                return lrcContent;
            }
            
            // ÊòæÁ§∫ËΩ¨Êç¢ÁªìÊûú
            function showResults() {
                if (convertedFiles.length === 0) return;
                
                resultsContainer.innerHTML = '';
                
                convertedFiles.forEach(file => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    const resultInfo = document.createElement('div');
                    resultInfo.className = 'result-info';
                    
                    const resultName = document.createElement('div');
                    resultName.className = 'result-name';
                    resultName.textContent = file.name;
                    
                    const resultStatus = document.createElement('div');
                    resultStatus.className = 'result-status';
                    resultStatus.textContent = `ËΩ¨Êç¢ÊàêÂäü (${formatFileSize(file.size)})`;
                    
                    resultInfo.appendChild(resultName);
                    resultInfo.appendChild(resultStatus);
                    
                    const downloadButton = document.createElement('button');
                    downloadButton.className = 'download-button';
                    downloadButton.textContent = '‰∏ãËΩΩ LRC Êñá‰ª∂';
                    downloadButton.addEventListener('click', () => {
                        const a = document.createElement('a');
                        a.href = file.url;
                        a.download = file.name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    });
                    
                    resultItem.appendChild(resultInfo);
                    resultItem.appendChild(downloadButton);
                    resultsContainer.appendChild(resultItem);
                });
                
                resultsSection.style.display = 'block';
            }
        });
    </script>
</body>
</html>